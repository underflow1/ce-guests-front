# Промпт для изменений бэкенда

## Общая информация

Фронтенд был переработан для работы с новой структурой данных. Необходимо обновить бэкенд для соответствия новым требованиям.

## Что нужно удалить

### 1. Роут `/utils/date-range`
**Полностью удалить** этот эндпоинт и всю связанную с ним логику. Он больше не используется фронтендом.

## Что нужно изменить

### 1. Эндпоинт `/entries`

#### Изменения в запросе:
- **Убрать обязательность параметра `today`** - теперь он опционален
- Если параметр `today` не передан → бэкенд сам вычисляет текущую дату
- Если параметр `today` передан → бэкенд использует переданную дату (для будущего функционала листания недель)

#### Изменения в ответе:

**Старая структура:**
```json
{
  "entries": [...],
  "date_range": [...]  // УДАЛИТЬ это поле
}
```

**Новая структура:**
```json
{
  "entries": [...],
  "reference_dates": {
    "previous_workday": "2026-01-28",
    "next_workday": "2026-01-30"
  },
  "calendar_structure": [
    {
      "date": "2026-01-26",
      "weekday": "Monday",
      "is_workday": true
    },
    {
      "date": "2026-01-27",
      "weekday": "Tuesday",
      "is_workday": true
    },
    {
      "date": "2026-01-28",
      "weekday": "Wednesday",
      "is_workday": true
    },
    {
      "date": "2026-01-29",
      "weekday": "Thursday",
      "is_workday": true
    },
    {
      "date": "2026-01-30",
      "weekday": "Friday",
      "is_workday": true
    },
    {
      "date": "2026-01-31",
      "weekday": "Saturday",
      "is_workday": false
    },
    {
      "date": "2026-02-01",
      "weekday": "Sunday",
      "is_workday": false
    }
  ]
}
```

## Детальное описание полей

### `reference_dates`

Объект с ключевыми датами:

- **`previous_workday`** (string, формат `YYYY-MM-DD`):
  - Предыдущий рабочий день относительно текущей даты (или переданной в параметре `today`)
  - Может быть с прошлой недели, если текущий день - понедельник
  - **Важно:** это именно предыдущий рабочий день (не календарный день -1), учитывает выходные и праздники

- **`next_workday`** (string, формат `YYYY-MM-DD`):
  - Следующий рабочий день относительно текущей даты (или переданной в параметре `today`)
  - Учитывает выходные и праздники

### `calendar_structure`

Массив объектов, описывающих структуру текущей недели (понедельник → воскресенье).

**Важно:** Всегда возвращаем только дни текущей недели (7 дней), независимо от того, какой день сегодня.

Каждый элемент массива содержит:

- **`date`** (string, формат `YYYY-MM-DD`): дата дня
- **`weekday`** (string): название дня недели на английском языке
  - Возможные значения: `"Monday"`, `"Tuesday"`, `"Wednesday"`, `"Thursday"`, `"Friday"`, `"Saturday"`, `"Sunday"`
  - **Важно:** только английские названия, локализация делается на фронте
- **`is_workday`** (boolean): является ли день рабочим
  - `true` - рабочий день
  - `false` - нерабочий день (праздник, перенос и т.д.)
  - **Важно:** суббота и воскресенье могут быть рабочими днями (`is_workday: true`), если есть перенос рабочих дней

## Логика определения текущей недели

- Текущая неделя = неделя, в которой находится текущая дата (или переданная в параметре `today`)
- Неделя начинается с понедельника и заканчивается воскресеньем
- Всегда возвращаем все 7 дней недели в массиве `calendar_structure`

## Логика определения рабочих дней

- Рабочие дни определяются бизнес-логикой (учитываются праздники, переносы и т.д.)
- Суббота и воскресенье по умолчанию нерабочие, но могут быть рабочими при переносах
- Праздничные дни в будние дни должны быть помечены как `is_workday: false`

## Примеры

### Пример 1: Сегодня четверг (2026-01-29)

**Запрос:** `GET /entries` (без параметра `today`)

**Ответ:**
```json
{
  "entries": [
    {
      "id": 123,
      "name": "Иван Иванов",
      "responsible": "Петр Петров",
      "datetime": "2026-01-29T09:00:00",
      "is_arrived": false
    }
  ],
  "reference_dates": {
    "previous_workday": "2026-01-28",
    "next_workday": "2026-01-30"
  },
  "calendar_structure": [
    {
      "date": "2026-01-26",
      "weekday": "Monday",
      "is_workday": true
    },
    {
      "date": "2026-01-27",
      "weekday": "Tuesday",
      "is_workday": true
    },
    {
      "date": "2026-01-28",
      "weekday": "Wednesday",
      "is_workday": true
    },
    {
      "date": "2026-01-29",
      "weekday": "Thursday",
      "is_workday": true
    },
    {
      "date": "2026-01-30",
      "weekday": "Friday",
      "is_workday": true
    },
    {
      "date": "2026-01-31",
      "weekday": "Saturday",
      "is_workday": false
    },
    {
      "date": "2026-02-01",
      "weekday": "Sunday",
      "is_workday": false
    }
  ]
}
```

### Пример 2: Сегодня понедельник (2026-01-26), предыдущий рабочий день - пятница прошлой недели

**Запрос:** `GET /entries`

**Ответ:**
```json
{
  "entries": [...],
  "reference_dates": {
    "previous_workday": "2026-01-23",
    "next_workday": "2026-01-27"
  },
  "calendar_structure": [
    {
      "date": "2026-01-26",
      "weekday": "Monday",
      "is_workday": true
    },
    {
      "date": "2026-01-27",
      "weekday": "Tuesday",
      "is_workday": true
    },
    {
      "date": "2026-01-28",
      "weekday": "Wednesday",
      "is_workday": true
    },
    {
      "date": "2026-01-29",
      "weekday": "Thursday",
      "is_workday": true
    },
    {
      "date": "2026-01-30",
      "weekday": "Friday",
      "is_workday": true
    },
    {
      "date": "2026-01-31",
      "weekday": "Saturday",
      "is_workday": false
    },
    {
      "date": "2026-02-01",
      "weekday": "Sunday",
      "is_workday": false
    }
  ]
}
```

### Пример 3: Праздничный день в будний день

**Ответ:**
```json
{
  "entries": [...],
  "reference_dates": {
    "previous_workday": "2026-01-27",
    "next_workday": "2026-01-30"
  },
  "calendar_structure": [
    {
      "date": "2026-01-26",
      "weekday": "Monday",
      "is_workday": true
    },
    {
      "date": "2026-01-27",
      "weekday": "Tuesday",
      "is_workday": true
    },
    {
      "date": "2026-01-28",
      "weekday": "Wednesday",
      "is_workday": false
    },
    {
      "date": "2026-01-29",
      "weekday": "Thursday",
      "is_workday": true
    },
    {
      "date": "2026-01-30",
      "weekday": "Friday",
      "is_workday": true
    },
    {
      "date": "2026-01-31",
      "weekday": "Saturday",
      "is_workday": false
    },
    {
      "date": "2026-02-01",
      "weekday": "Sunday",
      "is_workday": false
    }
  ]
}
```

## Записи (entries)

Массив `entries` должен содержать все записи за период:
- Текущая неделя (все 7 дней)
- Предыдущий рабочий день (если он не попадает в текущую неделю)

То есть обычно это 7 дней, иногда 8 (если предыдущий рабочий день с прошлой недели).

## Важные замечания

1. **Параметр `today` опционален** - если не передан, используем текущую дату сервера
2. **Параметр `today` поддерживается** для будущего функционала листания недель
3. **Всегда возвращаем текущую неделю** в `calendar_structure` (7 дней)
4. **Дни недели только на английском** - локализация на фронте
5. **`is_workday` учитывает праздники и переносы** - не просто проверка на выходной
6. **Удалить поле `date_range`** из ответа `/entries` (если оно было)
7. **Удалить роут `/utils/date-range`** полностью

## Чеклист для реализации

- [ ] Удален роут `/utils/date-range`
- [ ] Параметр `today` в `/entries` сделан опциональным
- [ ] Добавлено поле `reference_dates` с `previous_workday` и `next_workday`
- [ ] Добавлено поле `calendar_structure` с массивом дней текущей недели
- [ ] Каждый день в `calendar_structure` содержит `date`, `weekday` (английский), `is_workday`
- [ ] Удалено поле `date_range` из ответа `/entries` (если было)
- [ ] Логика определения рабочих дней учитывает праздники и переносы
- [ ] Всегда возвращается текущая неделя (7 дней) в `calendar_structure`
- [ ] Записи (`entries`) включают текущую неделю + предыдущий рабочий день (если не в текущей неделе)
